# Contributing

## Development

### Local setup

Clone this repository, install deps and create an `.env.local` file by running:

```bash
yarn
cp .env.example .env.local
```

Adjust values in the created `.env.local` accordingly.

### Start dev server

Start the frontend with a dev server by running:

```bash
yarn start
```

### Build production bundle

```bash
yarn build
```

### Env variables

#### Required

```bash
# Chain ID where HubPool contract is deployed
REACT_APP_HUBPOOL_CHAINID=
# An Infura ID used to set up providers
REACT_APP_PUBLIC_INFURA_ID=
# Onboard api key
REACT_APP_PUBLIC_ONBOARD_API_KEY=
# Custom provider for Polygon node
REACT_APP_CHAIN_137_PROVIDER_URL=
# Custom provider for Arbitrum node
REACT_APP_CHAIN_42161_PROVIDER_URL=
# Url for the Rewards view API
REACT_APP_REWARDS_API_URL=
```

#### Optional

```bash
# How many confirms before we consider transaction mined
REACT_APP_CONFIRMATIONS=
# Additional gas price to add to ensure enough buffer when sending max eth tx, specify in gwei
REACT_APP_GAS_PRICE_BUFFER=
# Default gas price estimate when no online estimate is available, specify in gwei
REACT_APP_DEFAULT_GAS_PRICE=
# how frequently to update gas prices in MS, used for estimating adding liquidity when maxing eth. Default 30000 (30 sec).
REACT_APP_UPDATE_GAS_INTERVAL_MS=
# Displays a maintenance banner and disables the AddLiquidityForm in the Pool view.
REACT_APP_DISABLE_DEPOSITS=
# Display React-Query dev tools if set to `true`.
REACT_APP_ENABLE_REACT_QUERY_DEV_TOOLS=
# Enable matomo by setting the matomo url, app will ignore events if not defined.
REACT_APP_MATOMO_URL=
# Warns user to check liquidity on V1 on Pool tab when set to `true`.
REACT_APP_MIGRATION_POOL_V2_WARNING=
# Set to 1 (or any value) to enable debug logs. Leave undefined to disable logs.
REACT_APP_DEBUG=
# How quickly to poll blocks on chain, default 30 seconds if not supplied.
REACT_APP_DEFAULT_BLOCK_POLLING_INTERVAL_S=
# The flat percentage fee that users should pay relayers for their capital. Value of 1 = 1%.
REACT_APP_FLAT_RELAY_CAPITAL_FEE=
# Show rewards banner warning on /rewards page if set to `true`.
REACT_APP_REWARDS_BANNER_WARNING=
```

### Important CSS values

#### Z-index

Navbar - 1000

## Internal Contributions

This section outlines best practices for internal contributors, these are people who have direct access to the repository.
We currently do not have a process for external contributors but will add a section for that when applicable.

### Best Practices

- It's recommended to branch directly from the repo for easier collaboration. This doc will assume you branch from `origin/master`.
- All changes to master should first be a pull request.
- PR titles should conform to [conventional commits](https://www.conventionalcommits.org/en/v1.0.0/).
- Branch names should ideally be generated by [Shortcut](www.shortcut.com) issues, but otherwise there's no particular naming convention.
- Try to keep PRs focused on a single feature, bug, or issue.
- Document motivation for change in the PR, i.e. link to issue or describe reason for change.
- If the change is relatively complex, use the PR description to summarize what code was changed and why.
- If you want to make multiple changes in a PR, make sure they are small and document the motivation for each.
- Include screenshots when applicable. Before and after is ideal, though after, alone, is acceptable.
- Tag at least 2 reviewers. Most PRs should be merged in after 2 approvals, but low risk or high urgency PRs can be merged with 1.
- The owner of the PR merges the PR once approved.
- If changes are UI oriented, notify QA for additional approval above the technical review before PR is merged.

### Feature Branches

Use feature branches when you need to split up changes to the app which may break the app or introduce incomplete features.

- Name the branch based on the epic, story, feature or issue. Ideally, this name links back to the original shortcut card.
- Denote a feature branch with the prefix "epic/", for example "epic/l1tol2". We will reserve "epic" for feature branches.
- Open pull requests to feature branch, following the same best practices.
- Nominate someone to occasionally rebase feature branch to master when working as a team.
- QA should review individual PR's before merging to feature branch, though a final holistic QA process should be done before merging feature branch to master.
- When merging a feature branch, rebase it onto master before merge. See following sections for more information.

### Maintaining Branches

To avoid long-lived branches diverging from `master`, it's recommended to rebase rather than merge changes from master.
This makes it easy to spot problems during review as the commit history should only show your changes.
The frequency of rebasing is dependent on how quickly your branch is getting out of date, but you should generally rebase soon after you see changes on your upstream branch.
It's also recommended to rebase before opening a PR.

### Quick Rebase Guide

This guide assumes you have a branch in the repository, and not a fork, and the github repository is named `origin`.

1. Start on your branch. Ensure there are no uncommitted changes, if so commit or stash them.
2. `git fetch origin master` - This will fetch latest changes to master without switching branches. This assumes your upstream repository is names "origin".
3. `git rebase HEAD~X --onto origin/master` - Rebase your changes on top of the latest changes on master, where X is the number of commits you have made to your branch.
4. If conflicts occur, fix them, `git add` them and `git rebase --continue` until the rebase is complete.
5. If you have stashed changes before the rebase, `git stash pop` them and commit them or keep working.
6. When updating an existing PR, you can't just `git push`, but you must `git push -f` or [`git push --force-with-lease`](https://stackoverflow.com/questions/52823692/git-push-force-with-lease-vs-force#:~:text=force%20overwrites%20a%20remote%20branch,elses%20work%20by%20force%20pushing.).

For more details on rebasing, [see this guide](https://medium.com/@dirk.avery/the-definitive-git-rebase-guide-dbd7717f9437)
